;
(self.AMP=self.AMP||[]).push({m:1,v:"2508201830000",n:"amp-viewer-integration",ev:"0.1",l:!0,p:"high",f:function(t,s){(()=>{var s;function e(){return s||(s=Promise.resolve(void 0))}var{isArray:n}=Array;function i(t,s){const e=t.length-s.length;return e>=0&&t.indexOf(s,e)==e}var{hasOwnProperty:r,toString:o}=Object.prototype;function h(t){const s=Object.create(null);return t&&Object.assign(s,t),s}function c(t,s,e,n,i,r,o,h,c,u,l){return t}var u=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function l(t,s=""){try{return decodeURIComponent(t)}catch(t){return s}}function a(t){const s=Object.getOwnPropertyDescriptor(t,"message");if(null!=s&&s.writable)return t;const{message:e,stack:n}=t,i=new Error(e);for(const s in t)i[s]=t[s];return i.stack=n,i}function f(t){let s=null,e="";for(const t of arguments)t instanceof Error&&!s?s=a(t):(e&&(e+=" "),e+=t);return s?e&&(s.message=e+": "+s.message):s=new Error(e),s}function d(t,...s){const e=f.apply(null,s);e.name=t||e.name,function(t){var s,e;null===(s=(e=self).__AMP_REPORT_ERROR)||void 0===s||s.call(e,t)}(e)}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var _=self.__AMP_LOG;function p(t,s){throw new Error("failed to call initLogConstructor")}function P(t){return _.user||(_.user=A()),function(t,s){return s&&s.ownerDocument.defaultView!=t}(_.user.win,t)?_.userForEmbed||(_.userForEmbed=A()):_.user}function A(t){return p()}function m(){return _.dev||(_.dev=p())}function E(t,s,e,n,i,r,o,h,c,u,l){return t}function g(t,s,e,n,i,r,o,h,c,u,l){return P().assert(t,s,e,n,i,r,o,h,c,u,l)}function T(t,s){return y(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),s)}function v(t,s){return y(M(w(t)),s)}function w(t){return t.nodeType?(e=t,s=(e.ownerDocument||e).defaultView,T(s,"ampdoc")).getAmpDoc(t):t;var s,e}function M(t){const s=w(t);return s.isSingleDoc()?s.win:s}function y(t,s){E(I(t,s));const e=function(t){let s=t.__AMP_SERVICES;return s||(s=t.__AMP_SERVICES={}),s}(t)[s];return e.obj||(E(e.ctor),E(e.context),e.obj=new e.ctor(e.context),E(e.obj),e.context=null,e.resolve&&e.resolve(e.obj)),e.obj}function I(t,s){const e=t.__AMP_SERVICES&&t.__AMP_SERVICES[s];return!(!e||!e.ctor)}var R,V=t=>T(t,"platform"),b=t=>v(t,"viewer"),x=t=>v(t,"viewport"),k=["Webkit","webkit","Moz","moz","ms","O","o"],S={"getPropertyPriority":()=>"","getPropertyValue":()=>""};function F(t){const s=t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));return k.some((t=>s.startsWith(t+"-")))?`-${s}`:s}function N(t,s,e){if(Y(s))return s;R||(R=h());let n=R[s];if(!n||e){if(n=s,void 0===t[s]){const e=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(s),i=function(t,s){for(let e=0;e<k.length;e++){const n=k[e]+s;if(void 0!==t[n])return n}return""}(t,e);void 0!==t[i]&&(n=i)}e||(R[s]=n)}return n}function H(t,s){const{style:e}=t;for(const t in s)e.setProperty(F(N(e,t)),String(s[t]),"important")}function O(t,s,e,n,i){const r=N(t.style,s,i);if(!r)return;const o=n?e+n:e;t.style.setProperty(F(r),o)}function C(t,s,e){const n=N(t.style,s,e);if(n)return Y(n)?t.style.getPropertyValue(n):t.style[n]}function L(t,s){for(const e in s)O(t,e,s[e])}function U(t,s){const{style:e}=t;c(""!==s&&"none"!==s),c(!e.display),e.display=s}function D(t,s){return t.getComputedStyle(s)||S}function z(t,s){for(let e=0;e<s.length;e++)O(t,s[e],null)}function Y(t){return t.startsWith("--")}var q=class t{static solveYValueFromXValue(s,e,n,i,r,o,h,c,u){return t.vr(t.Er(s,e,i,o,c),n,r,h,u)}static Er(s,e,n,i,r){const o=1e-6;let h=(s-e)/(r-e);if(h<=0)return 0;if(h>=1)return 1;let c=0,u=1,l=0;for(let a=0;a<8;a++){l=t.Tr(h,e,n,i,r);const a=(t.Tr(h+o,e,n,i,r)-l)/o;if(Math.abs(l-s)<o)return h;if(Math.abs(a)<o)break;l<s?c=h:u=h,h-=(l-s)/a}for(let a=0;Math.abs(l-s)>o&&a<8;a++)l<s?(c=h,h=(h+u)/2):(u=h,h=(h+c)/2),l=t.Tr(h,e,n,i,r);return h}static Tr(s,e,n,i,r){if(0==s)return e;if(1==s)return r;let o=t.Rr(e,n,s),h=t.Rr(n,i,s);const c=t.Rr(i,r,s);return o=t.Rr(o,h,s),h=t.Rr(h,c,s),t.Rr(o,h,s)}static vr(s,e,n,i,r){if(0==s)return e;if(1==s)return r;let o=t.Rr(e,n,s),h=t.Rr(n,i,s);const c=t.Rr(i,r,s);return o=t.Rr(o,h,s),h=t.Rr(h,c,s),t.Rr(o,h,s)}static Rr(t,s,e){return t+e*(s-t)}},X={LINEAR:t=>t,EASE:t=>q.solveYValueFromXValue(t,0,0,.25,.1,.25,1,1,1),EASE_IN:t=>q.solveYValueFromXValue(t,0,0,.42,0,1,1,1,1),EASE_OUT:t=>q.solveYValueFromXValue(t,0,0,0,0,.58,1,1,1),EASE_IN_OUT:t=>q.solveYValueFromXValue(t,0,0,.42,0,.58,1,1,1)},K={"linear":X.LINEAR,"ease":X.EASE,"ease-in":X.EASE_IN,"ease-out":X.EASE_OUT,"ease-in-out":X.EASE_IN_OUT};function $(t){if(!t)return null;if("string"==typeof t){if(-1!=t.indexOf("cubic-bezier")){const r=t.match(/cubic-bezier\((.+)\)/);if(r){const t=r[1].split(",").map(parseFloat);if(4==t.length){for(let s=0;s<4;s++)if(isNaN(t[s]))return null;return s=t[0],e=t[1],n=t[2],i=t[3],t=>q.solveYValueFromXValue(t,0,0,s,e,n,i,1,1)}}return null}return K[t]}var s,e,n,i;return t}var j,W="Animation",J=function(){},B=class t{static animate(s,e,n,i){return new t(s).setCurve(i).add(0,e,1).start(n)}constructor(t,s){this.Ir=t,this.Mr=s||T(self,"vsync"),this.yr=null,this.wr=[]}setCurve(t){return t&&(this.yr=$(t)),this}add(t,s,e,n){return this.wr.push({delay:t,func:s,duration:e,curve:$(n)}),this}start(t){return new G(this.Mr,this.Ir,this.wr,this.yr,t)}},G=class{constructor(t,s,e,n,i){this.Mr=t,this.Ir=s,this.wr=[];for(let t=0;t<e.length;t++){const s=e[t];this.wr.push({delay:s.delay,func:s.func,duration:s.duration,curve:s.curve||n,started:!1,completed:!1})}this.br=i,this.er=Date.now(),this.Be=!0,this.wi={};const r=new class{constructor(){this.promise=new Promise(((t,s)=>{this.resolve=t,this.reject=s}))}};this.Vr=r.promise,this.fe=r.resolve,this.Sr=r.reject,this.Or=this.Mr.createAnimTask(this.Ir,{mutate:this.Cr.bind(this)}),this.Mr.canAnimate(this.Ir)?this.Or(this.wi):this.kr(!1,0)}then(t,s){return t||s?this.Vr.then(t,s):this.Vr}thenAlways(t){const s=t||J;return this.then(s,s)}halt(t){this.kr(!1,t||0)}kr(t,s){if(this.Be){if(this.Be=!1,0!=s){this.wr.length>1&&this.wr.sort(((t,s)=>t.delay+t.duration-(s.delay+s.duration)));try{if(s>0)for(let t=0;t<this.wr.length;t++)this.wr[t].func(1,!0);else for(let t=this.wr.length-1;t>=0;t--)this.wr[t].func(0,!1)}catch(s){m().error(W,"completion failed: "+s,s),t=!1}}t?this.fe():this.Sr()}}Cr(t){if(!this.Be)return;const s=Date.now(),e=Math.min((s-this.er)/this.br,1);for(let t=0;t<this.wr.length;t++){const s=this.wr[t];!s.started&&e>=s.delay&&(s.started=!0)}for(let t=0;t<this.wr.length;t++){const s=this.wr[t];s.started&&!s.completed&&this.Nr(s,e)}1==e?this.kr(!0,0):this.Mr.canAnimate(this.Ir)?this.Or(this.wi):this.kr(!1,0)}Nr(t,s){let e,n;if(t.duration>0){if(e=Math.min((s-t.delay)/t.duration,1),n=e,t.curve&&1!=n)try{n=t.curve(e)}catch(t){return m().error(W,"step curve failed: "+t,t),void this.kr(!1,0)}}else e=1,n=1;1==e&&(t.completed=!0);try{t.func(n,t.completed)}catch(t){return m().error(W,"step mutate failed: "+t,t),void this.kr(!1,0)}}},Z="FixedLayer",Q="i-amphtml-lightbox",tt="i-amphtml-lightbox-element";function st(t){return-1!==t.tagName.indexOf("LIGHTBOX")}function et(t,s,e,n){let i=t,r=e,o=t=>{try{return r(t)}catch(t){var s,e;throw null===(s=(e=self).__AMP_REPORT_ERROR)||void 0===s||s.call(e,t),t}};const h=function(){if(void 0!==j)return j;j=!1;try{const t={get capture(){return j=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return j}(),c=!(null==n||!n.capture);return i.addEventListener(s,o,h?n:c),()=>{null==i||i.removeEventListener(s,o,h?n:c),r=null,i=null,o=null}}function nt(t,s,e,n){return et(t,s,e,n)}function it(t,s,e,n){let i=e;const r=et(t,s,(t=>{try{i(t)}finally{i=null,r()}}),n);return r}function rt(t){return"loading"!=t.readyState&&"uninitialized"!=t.readyState}function ot(t,s,e){return 0==s&&0==e||0==t.width&&0==t.height?t:{left:n=t.left+s,top:i=t.top+e,width:r=t.width,height:o=t.height,bottom:i+o,right:n+r,x:n,y:i};var n,i,r,o}function ht(t){return t.node.wholeText[t.offset]}var ct=/[,.\s\u2022()]/;function ut(t){return"’"==t||"‘"==t?"'":"“"==t||"”"==t?'"':t.toLowerCase()}function lt(t){const s=[];for(let e=0;e<t.length;e++){const n=t[e];ct.test(n)||s.push(ut(n))}return s.join("")}var at=class{constructor(t,s){this.tE=t,this.sE=s,this.matches=[],this.eE={},this.nE=t.length-1;for(let s=0;s<t.length;s++){const e=t[s];this.eE[e]=t.length-1-s}}update(){if(this.nE>0)return void this.nE--;const{sE:t,tE:s}=this,e=t.size();for(let n=0;n<s.length;n++){const i=ut(ht(t.get(e-1-n).pos));if(s[s.length-1-n]==i)continue;let r=this.eE[i];return null==r&&(r=s.length),r-=n,r<1&&(r=1),void(this.nE=r-1)}const n=t.get(e-1),i=n.pos;this.matches.push({start:t.get(e-s.length),end:{pos:{node:i.node,offset:i.offset+1},idx:n.idx+1}})}};function ft(t,s,e,n){for(let i=e;i<n.length;i++){const e=n[i];if(t.node!=e.start.node)return;if(e.start.node=s,e.start.offset-=t.offset,t.node!=e.end.node)return;e.end.node=s,e.end.offset-=t.offset}}function dt(t,s,e,n,i,r){for(;;){if(s.node==e.node){const o=_t(t,s.node,s.offset,e.offset,r);return void(o&&ft(e,o,i+1,n))}const o=pt(t,s.node);if(_t(t,s.node,s.offset,s.node.wholeText.length,r),!o)break;s={node:o,offset:0}}}function _t(t,s,e,n,i){if(e>=n)return null;const r=t.document,{parentNode:o,wholeText:h}=s;e>0&&o.insertBefore(r.createTextNode(h.substring(0,e)),s);const c=r.createElement("span");c.appendChild(r.createTextNode(h.substring(e,n))),o.insertBefore(c,s),i.push(c);let u=null;return n<h.length&&(u=r.createTextNode(h.substring(n)),o.insertBefore(u,s)),o.removeChild(s),u}function pt(t,s){let e=!0,n=s;for(;;){if(null==n)return null;if(e){const t=n.nextSibling;t?(n=t,e=!1):n=n.parentNode}else{if(n instanceof t.Text)return n;n.firstChild?n=n.firstChild:e=!0}}}var Pt=["key","code","location","ctrlKey","shiftKey","altKey","metaKey","repeat","isComposing","charCode","keyCode","which"],At="amp-viewer-messaging",mt="channelOpen",Et="__AMPHTML__";function gt(t){if("string"!=typeof t)return t;if("{"!=t.charAt(0))return null;try{return JSON.parse(t)}catch(t){return null}}var Tt,vt=class{constructor(t,s,e){this.i=t,this.h=s,this.o=e}addEventListener(t,s){this.i.addEventListener("message",(t=>{t.origin==this.h&&t.source==this.o&&s(t)}))}postMessage(t){const s="null"===this.h?"*":this.h;this.o.postMessage(t,s)}start(){}},wt=class t{static initiateHandshakeWithDocument(s,e){return new Promise((n=>{const i=setInterval((()=>{const r=new MessageChannel,o={app:Et,name:"handshake-poll"};s.postMessage(o,"*",[r.port2]);const h=r.port1,c=s=>{const r=gt(s.data);if(r&&r.app===Et&&r.name===mt){clearInterval(i),h.removeEventListener("message",c);const s=new t(null,h,!1,e,!0);s.t(r.requestid,mt,null),n(s)}};h.addEventListener("message",c),h.start()}),1e3)}))}static waitForHandshakeFromDocument(s,e,n,i,r){return new Promise((o=>{const h=c=>{const u=gt(c.data);if(u&&(c.origin==n||r&&r.test(c.origin))&&(!c.source||c.source==e)&&u.app===Et&&u.name===mt){s.removeEventListener("message",h);const n=new vt(s,c.origin,e),r=new t(null,n,!1,i,!0);r.t(u.requestid,mt,null),o(r)}};s.addEventListener("message",h)}))}constructor(t,s,e,n,i){this.i=t,this.l=s,this.u=!!e,this._=n||null,this.p=!!i,this.g=0,this.m={},this.P={},this.A=null,this.l.addEventListener("message",this.R.bind(this)),this.l.start()}registerHandler(t,s){this.P[t]=s}unregisterHandler(t){delete this.P[t]}setDefaultHandler(t){this.A=t}R(t){const s=gt(t.data);s&&s.app===Et&&(this._&&this.p&&s.messagingToken!==this._?this.M(At+": handleMessage_ error: ","invalid token"):"q"===s.type?this.q(s):"s"===s.type&&this.v(s))}sendRequest(t,s,e){const n=++this.g;let i;return e&&(i=new Promise(((t,s)=>{this.m[n]={resolve:t,reject:s}}))),this.I({app:Et,requestid:n,type:"q",name:t,data:s,rsvp:e}),i}t(t,s,e){this.I({app:Et,requestid:t,type:"s",name:s,data:e})}T(t,s,e){const n=this.V(e);this.M(At+": sendResponseError_, message name: "+s,n),this.I({app:Et,requestid:t,type:"s",name:s,data:null,error:n})}I(t){const s=Object.assign(t,{});this._&&!this.p&&(s.messagingToken=this._),this.l.postMessage(this.u?JSON.stringify(s):s)}q(t){let s=this.P[t.name];if(s||(s=this.A),!s){const s=new Error("Cannot handle request because no default handler is set!");throw s.args=t.name,s}const e=s(t.name,t.data,!!t.rsvp);if(t.rsvp){const s=t.requestid;if(!e)throw this.T(s,t.name,new Error("no response")),new Error("expected response but none given: "+t.name);e.then((e=>{this.t(s,t.name,e)}),(e=>{this.T(s,t.name,e)}))}}v(t){const s=t.requestid,e=this.m[s];e&&(delete this.m[s],t.error?(this.M(At+": handleResponse_ error: ",t.error),e.reject(new Error(`Request ${t.name} failed: ${t.error}`))):e.resolve(t.data))}M(t,s){if(!this.i)return;let e="amp-messaging-error-logger: "+t;e+=" data: "+this.V(s),this.i.viewerState=e}V(t){return t?t.message?t.message:String(t):"unknown error"}},Mt=["altKey","charCode","ctrlKey","detail","eventPhase","key","layerX","layerY","metaKey","pageX","pageY","returnValue","shiftKey","timeStamp","type","which"],yt=["clientX","clientY","force","identifier","pageX","pageY","radiusX","radiusY","screenX","screenY"],It=(()=>self.AMP.config.urls)(),Rt=new Set(["c","v","a","ad"]),Vt=t=>"string"==typeof t?function(t,s){return Tt||(Tt=self.document.createElement("a")),function(t,s,e){return t.href="",new URL(s,t.href)}(Tt,t)}(t):t;new class{constructor(t){this.win=t,this.iE=!1,this.rE=!1,this.oE=null}init(){const t=w(this.win.document),s=b(t);this.iE="1"==s.getParam("webview"),this.rE=s.hasCapability("handshakepoll");const n=s.getParam("messagingToken"),r=s.getParam("origin")||"";if(!this.iE&&!r)return e();if(x(t).createFixedLayer(class{constructor(t,s,e,n,i){this.ampdoc=t,this.Mr=s,this.hE=e,this.Hr=n,this.cE=n,this.uE=i&&t.isSingleDoc(),this.lE=null,this.aE=0,this.kt=[],this.fE=new class{constructor(t,s,e){this.De=y(t,"timer"),this.Le=s,this.Ue=e||0,this.$e=-1,this.Fe=0,this.Be=!1,this.He=()=>{this.je()}}isPending(){return-1!=this.$e}schedule(t){let s=t||this.Ue;this.Be&&s<10&&(s=10);const e=Date.now()+s;return(!this.isPending()||e-this.Fe<-10)&&(this.cancel(),this.Fe=e,this.$e=this.De.delay(this.He,s),!0)}je(){this.$e=-1,this.Fe=0,this.Be=!0,this.Le(),this.Be=!1}cancel(){this.isPending()&&(this.De.cancel(this.$e),this.$e=-1)}}(t.win,(()=>this.update())),this.dE=null,this._E=[],this.pE=[]}enterLightbox(t,s){const e=this.PE();e&&e.setLightboxMode(!0),t&&s&&s.then((()=>this.AE(t,!0)))}leaveLightbox(){const t=this.PE();t&&t.setLightboxMode(!1);const s=function(t,s){const e=[];let n=0;for(let s=0;s<t.length;s++){const i=t[s];i.lightboxed?e.push(i):(n<s&&(t[n]=i),n++)}return n<t.length&&(t.length=n),e}(this.kt);this.mE(s),this.kt.length||this.EE()}setup(){if(!b(this.ampdoc).isEmbedded())return!1;const t=this.ampdoc.getRootNode(),s=t.styleSheets;if(!s)return!0;this._E.length=0,this.pE.length=0;for(let t=0;t<s.length;t++){const e=s[t];if(!e)return m().error(Z,"Aborting setup due to null stylesheet."),!0;const{disabled:n,ownerNode:i}=e;n||!i||"STYLE"!=i.tagName||i.hasAttribute("amp-boilerplate")||i.hasAttribute("amp-runtime")||i.hasAttribute("amp-extension")||this.gE(e.cssRules)}this.AE(t),this.kt.length>0&&this.observeHiddenMutations();const e=V(this.ampdoc.win);return this.kt.length>0&&!this.uE&&e.isIos(),!0}AE(t,s){this.TE(t,s),this.vE(),this.update()}observeHiddenMutations(){this.wE()}EE(){this.fE.cancel();const t=this.dE;t&&(t(),this.dE=null)}wE(){if(this.dE)return;const t=this.ampdoc.getRootNode(),s=(t=>function(t,s){const e=M(w(t));return I(e,s)?y(e,s):null}(t,"hidden-observer"))(t.documentElement||t);this.dE=s.add((()=>{this.fE.isPending()||this.fE.schedule(16)}))}updatePaddingTop(t,s){this.Hr=t,s||(this.cE=t),this.update()}transformMutate(t){t?this.kt.forEach((s=>{s.fixedNow&&s.top&&(O(s.element,"transition","none"),s.transform&&"none"!=s.transform?O(s.element,"transform",s.transform+" "+t):O(s.element,"transform",t))})):this.kt.forEach((t=>{t.fixedNow&&t.top&&L(t.element,{transform:"",transition:""})}))}addElement(t,s){return this.ME(t,"*","fixed",s)?(this.vE(),this.observeHiddenMutations(),this.update()):e()}removeElement(t){const s=this.yE(t);this.mE(s)}mE(t){t.length>0&&this.lE&&this.Mr.mutate((()=>{for(let s=0;s<t.length;s++){const e=t[s];"fixed"==e.position&&this.lE.returnFrom(e)}}))}isDeclaredFixed(t){return!!t.__AMP_DECLFIXED}isDeclaredSticky(t){return!!t.__AMP_DECLSTICKY}update(){if(this.kt.filter((t=>!this.ampdoc.contains(t.element))).forEach((t=>this.yE(t.element))),0==this.kt.length)return e();this.fE.cancel();let t=!1;return this.Mr.runPromise({measure:s=>{const e=this.kt,n=[],{win:r}=this.ampdoc;for(let t=0;t<e.length;t++)H(e[t].element,{top:"",bottom:"-9999vh",transition:"none"});for(let t=0;t<e.length;t++)n.push(D(r,e[t].element).top);for(let t=0;t<e.length;t++)O(e[t].element,"bottom","");for(let o=0;o<e.length;o++){const h=e[o],{element:c,forceTransfer:u}=h,l=D(r,c),{offsetHeight:a,offsetTop:f,offsetWidth:d}=c,{bottom:_,display:p="",position:P="",zIndex:A}=l,m=parseFloat(l.opacity),E=l[N(l,"transform")];let{top:g}=l;const T="fixed"===P&&(u||d>0&&a>0),v=i(P,"sticky");if("none"===p||!T&&!v){s[h.id]={fixed:!1,sticky:!1,transferrable:!1,top:"",zIndex:""};continue}"auto"!==g&&n[o]===g||(g=T&&f===this.cE+this.hE?"0px":"");let w=!1;T&&(w=!0===u||!1!==u&&m>0&&a<300&&!(!g&&!_)),w&&(t=!0),s[h.id]={fixed:T,sticky:v,transferrable:w,top:g,zIndex:A,transform:E}}},mutate:s=>{t&&this.uE&&this.PE().update();const e=this.kt;for(let t=0;t<e.length;t++){const n=e[t],i=s[n.id];O(n.element,"transition","none"),O(n.element,"transition",""),i&&this.IE(n,t,i)}}},{}).catch((t=>{m().error(Z,"Failed to mutate fixed elements:",t)}))}TE(t,s){try{this.RE(t,s)}catch(t){m().error(Z,"Failed to setup fixed elements:",t)}}RE(t,s){for(let e=0;e<this._E.length;e++){const n=this._E[e],i=t.querySelectorAll(n);for(let t=0;t<i.length&&!(this.kt.length>10);t++)this.ME(i[t],n,"fixed",void 0,s)}for(let e=0;e<this.pE.length;e++){const n=this.pE[e],i=t.querySelectorAll(n);for(let t=0;t<i.length;t++)this.ME(i[t],n,"sticky",void 0,s)}}VE(t){t.hasAttribute("style")&&(C(t,"top")||C(t,"bottom"))&&P().error(Z,"Inline styles with `top`, `bottom` and other CSS rules are not supported yet for fixed or sticky elements (#14186). Unexpected behavior may occur.",t)}ME(t,s,e,n,i){if(n||this.VE(t),st(t))return!1;const r=function(t,s,e){let n;for(n=t;n&&void 0!==n;n=n.parentElement)if(s(n))return n;return null}(t,st);if(!i&&r)return!1;const o=this.kt,h=[];for(let s=0;s<o.length;s++){const e=o[s].element;if(e===t)break;if(e.contains(t))return!1;t.contains(e)&&h.push(e)}for(let t=0;t<h.length;t++)this.removeElement(h[t]);let c=null;for(let s=0;s<o.length;s++){const n=o[s];if(n.element==t&&n.position==e){c=n;break}}const u="fixed"==e;if(c)c.selectors.includes(s)||c.selectors.push(s);else{const n="F"+this.aE++;t.setAttribute("i-amphtml-fixedid",n),u?t.__AMP_DECLFIXED=!0:t.__AMP_DECLSTICKY=!0,c={id:n,element:t,position:e,selectors:[s],fixedNow:!1,stickyNow:!1,lightboxed:!!r},o.push(c)}return c.forceTransfer=!!u&&n,!0}yE(t){const s=[];for(let e=0;e<this.kt.length;e++){const n=this.kt[e];n.element===t&&(n.lightboxed||this.Mr.mutate((()=>{O(t,"top","")})),this.kt.splice(e,1),s.push(n))}return this.kt.length||this.EE(),s}vE(){this.kt.sort(((t,s)=>{return(e=t.element)===(n=s.element)?0:e.compareDocumentPosition(n)&(Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINS)?1:-1;var e,n}))}IE(t,s,e){const{element:n,fixedNow:i}=t;t.fixedNow=e.fixed,t.stickyNow=e.sticky,t.top=e.fixed||e.sticky?e.top:"",t.transform=e.transform,!i||e.fixed&&e.transferrable||!this.lE||this.lE.returnFrom(t),e.top&&(e.fixed||e.sticky)&&!t.lightboxed&&(e.fixed||!this.uE?O(n,"top",`calc(${e.top} + ${this.Hr}px)`):this.cE===this.Hr?O(n,"top",e.top):O(n,"top",`calc(${e.top} - ${this.cE}px)`)),this.uE&&e.fixed&&e.transferrable&&this.PE().transferTo(t,s,e)}PE(){if(!this.uE||this.lE)return this.lE;const t=this.ampdoc.win.document;return this.lE=new class{constructor(t,s){var e;this.qf=t,this.Mr=s,this.bE=t.body.cloneNode(!1),this.bE.removeAttribute("style"),L(this.bE,("display"in(e={position:"absolute",top:0,left:0,height:0,width:0,pointerEvents:"none",overflow:"hidden",animation:"none",background:"none",border:"none",borderImage:"none",boxSizing:"border-box",boxShadow:"none",float:"none",margin:0,opacity:1,outline:"none",padding:"none",transform:"none",transition:"none"})&&d("STYLE","`display` style detected. You must use toggle instead."),e)),U(this.bE,"block"),t.documentElement.appendChild(this.bE)}getRoot(){return this.bE}setLightboxMode(t){this.Mr.mutate((()=>{const s=this.getRoot();t?s.setAttribute(Q,""):s.removeAttribute(Q)}))}update(){const{body:t}=this.qf,s=this.bE,e=t.attributes,n=s.attributes;for(let t=0;t<e.length;t++){const s=e[t];"style"!==s.name&&n.setNamedItem(s.cloneNode(!1))}for(let e=0;e<n.length;e++){const{name:i}=n[e];"style"===i||i===Q||t.hasAttribute(i)||(s.removeAttribute(i),e--)}}transferTo(t,s,e){const{element:n}=t;if(n.parentElement!=this.bE){if(!t.placeholder){O(n,"pointer-events","initial");const s=t.placeholder=this.qf.createElement("i-amphtml-fpa");!function(t,s){void 0===s&&(s=t.hasAttribute("hidden")),s?t.removeAttribute("hidden"):t.setAttribute("hidden","")}(s,!1),s.setAttribute("i-amphtml-fixedid",t.id)}O(n,"zIndex",`calc(${1e4+s} + ${e.zIndex||0})`),t.lightboxed&&n.classList.add(tt),n.parentElement.replaceChild(t.placeholder,n),this.bE.appendChild(n),t.selectors.some((t=>this.xE(n,t)))||this.returnFrom(t)}}returnFrom(t){if(!t.placeholder||!this.qf.contains(t.placeholder))return;const{element:s,placeholder:e}=t;t.lightboxed&&s.classList.remove(tt),this.qf.contains(s)?(O(t.element,"zIndex",""),e.parentElement.replaceChild(s,e)):e.parentElement.removeChild(e)}xE(t,s){try{return function(t,s){return t.matches(s)}(t,s)}catch(t){return m().error(Z,"Failed to test query match:",t),!1}}}(t,this.Mr),this.lE}gE(t){for(let s=0;s<t.length;s++){const e=t[s];if(4!=e.type&&12!=e.type){if(1==e.type){const{selectorText:t}=e,{position:s}=e.style;if("*"===t||!s)continue;"fixed"===s?this._E.push(t):i(s,"sticky")&&this.pE.push(t)}}else this.gE(e.cssRules)}}animateFixedElements(t,s,n,i,r){return this.updatePaddingTop(t,r),n<=0?e():B.animate(this.ampdoc.getRootNode(),(e=>{const n=(e=>s-t+(t-s)*e)(e);this.transformMutate(`translateY(${n}px)`)}),n,i).thenAlways((()=>{this.transformMutate(null)}))}}),this.iE||this.rE){const e=(o=this.win).parent&&o.parent!=o?this.win.parent:null;return this.kE(e,r).then((e=>this.SE(s,t,r,new wt(this.win,e,this.iE,n))))}var o;const c=function(t){const s=function(t){const s=h();if(!t)return s;let e;for(;e=u.exec(t);){const t=l(e[1],e[1]),n=e[2]?l(e[2].replace(/\+/g," "),e[2]):"";s[t]=n}return s}(t.win.location.hash).highlight;if(!s||s.length>102400)return null;const e=(n=s,JSON.parse(n));var n;const i=e.s;if(!(i instanceof Array)||i.length>15)return null;let r=0;for(let t=0;t<i.length;t++){const s=i[t];if("string"!=typeof s||!s)return null;if(r+=s.length,r>1500)return null}let o=!1;e.n&&(o=!0);let c=!1;return e.na&&(c=!0),{sentences:i,skipScrollAnimation:c,skipRendering:o}}(t);c&&(this.oE=new class{constructor(t,s){this.Gi=t,this.Ze=b(t),this.Xu=x(this.Gi),this.FE=null;const e=V(this.Gi.win);var n;"fragmentDirective"in document&&e.isChrome()&&e.getMajorVersion()>=93?t.whenFirstVisible().then((()=>this.NE(s))):(n=t.win.document,new Promise((t=>{!function(t,s){!function(t,s,e){let n=s(t);if(n)e(t);else{const i=()=>{s(t)&&(n||(n=!0,e(t)),t.removeEventListener("readystatechange",i))};t.addEventListener("readystatechange",i)}}(t,rt,s)}(n,t)}))).then((()=>{this.HE(s)}))}NE(t){const{sentences:s}=t;if(null==s||!s.length)return;const e=s.map((t=>"text="+encodeURIComponent(t))).join("&");this.OE(e)}OE(t){const{hash:s}=this.Gi.win.location;s?this.Gi.win.location.replace(s+":~:"+t):this.Gi.win.location.replace("#:~:"+t)}CE(t,s){const e={"state":t};for(const t in s)e[t]=s[t];this.Ze.sendMessage("highlightState",e)}LE(t){const{win:s}=this.Gi,e=function(t,s,e){if(e=function(t){const s=[];for(let e=0;e<t.length;e++){const n=lt(t[e]);n&&s.push(n)}return s}(e),e.length<=0)return null;const n=new class t{constructor(s,e){if(this.i=s,this.UE=e,this.DE=-1,this.zE=null,e instanceof s.Text)this.DE=0;else if(e instanceof s.Element){const{display:n}=D(s,e);if("none"==n)return;const i=e.firstChild;null!=i&&(this.zE=new t(s,i))}}next(){if(this.DE>=0)return this.YE();for(;null!=this.zE;){const s=this.zE.next();if(null!=s)return s;const e=this.zE.UE.nextSibling;this.zE=null!=e?new t(this.i,e):null}return null}YE(){const t=this.UE.wholeText;if(this.DE<t.length){const t=this.DE;return this.DE++,{node:this.UE,offset:t}}return null}}(t,s),i=new class{constructor(t){this.qE=t,this.XE=[],this.qe=0}push(t){this.XE[this.qe]=t,this.qe=(this.qe+1)%this.qE}get(t){return this.XE.length>=this.qE&&(t=(this.qe+t)%this.qE),this.XE[t]}size(){return this.XE.length}}(e.map((t=>t.length)).reduce(((t,s)=>Math.max(t,s)))),r=[new at(e[0],i)];let o=-1;for(;;){o++;const t=n.next();if(null==t)return null;if(!ct.test(ht(t))){i.push({pos:t,idx:o});for(let t=0;t<r.length;t++)r[t].update();if(0!=r[r.length-1].matches.length){if(r.length==e.length)break;r.push(new at(e[r.length],i))}}}const h=[];t:for(let t=e.length-1;t>=0;t--){const s=r[t].matches;if(0==h.length){h.push(s[s.length-1]);continue}const e=h[h.length-1];for(let t=s.length-1;t>=0;t--){const n=s[t];if(e.start.idx>=n.end.idx){h.push(n);continue t}}E(!1)}const c=[];for(let t=h.length-1;t>=0;t--){const s=h[t];c.push({start:s.start.pos,end:s.end.pos})}return c}(s,this.Gi.getBody(),t.sentences);if(!e)return;const n=function(t,s){s=function(t){const s=[];let e=null;for(let n=0;n<t.length;n++){const i=t[n];e&&e.end.node==i.start.node&&e.end.offset==i.start.offset?e.end=i.end:(e=i,s.push(i))}return s}(s);const e=[];for(let n=0;n<s.length;n++){const i=s[n];dt(t,i.start,i.end,s,n,e)}return e}(s,e);n&&0!=n.length&&(this.FE=n)}onVisibleOnce(t){t=function(t){let s=!1,e=null,n=t;return(...t)=>(s||(e=n.apply(self,t),s=!0,n=null),e)}(t),this.Gi.onVisibilityChanged((()=>{"visible"==this.Gi.getVisibilityState()&&t()}))}HE(t){if(this.Gi.win.document.querySelector('script[id="amp-access"]'))return void this.CE("has_amp_access");if(this.LE(t),!this.FE)return void this.CE("not_found");const s=this.KE();if(this.CE("found",{"scroll":s}),t.skipRendering)return;for(let t=0;t<this.FE.length;t++)L(this.FE[t],{backgroundColor:"#fcff00",color:"#000"});const e=this.Gi.getVisibilityState();t.skipScrollAnimation?"visible"==e?this.$E(s):(this.Xu.setScrollTop(s),this.onVisibleOnce((()=>{this.$E(this.KE())}))):"visible"==e?this.jE(s):(this.WE(s),this.onVisibleOnce((()=>{this.jE(this.KE())}))),it(this.Gi.getBody(),"click",this.JE.bind(this))}KE(){const t=this.FE;if(!t)return 0;const s=this.Xu;let e=Number.MAX_VALUE,n=0;const i=s.getPaddingTop();for(let r=0;r<t.length;r++){const{bottom:o,top:h}=ot(s.getLayoutRect(t[r]),0,-i);e=Math.min(e,h),n=Math.max(n,o)}if(e>=n)return 0;let r=(n+e-(s.getHeight()-i))/2;return r>e-80&&(r=e-80),r>0?r:0}$E(t){this.CE("auto_scroll"),this.Xu.setScrollTop(t),this.CE("shown")}WE(t){const s=Math.max(0,t-500);this.Xu.setScrollTop(s)}BE(t){const s=this.KE(),e=this.Xu.getScrollTop();if(e==s&&e==t)return null;const n={};return e!=s&&(this.Xu.setScrollTop(s),n.nd=e-s),e!=t&&(n.od=e-t),n}jE(t){this.WE(t);const s=this.Gi.win.document.createElement("div");U(s,"block"),L(s,{"position":"absolute","top":Math.floor(t)+"px","height":"1px","left":"0","width":"1px","pointer-events":"none"});const e=this.Gi.getBody();e.appendChild(s),this.CE("auto_scroll"),this.Xu.animateScrollIntoView(s).then((()=>{e.removeChild(s),this.CE("shown",this.BE(t))}))}setupMessaging(t){t.registerHandler("highlightDismiss",this.JE.bind(this))}JE(){if(this.FE)for(let t=0;t<this.FE.length;t++)z(this.FE[t],["backgroundColor","color"])}}(t,c));const a=new vt(this.win,r,this.win.parent);return this.SE(s,t,r,new wt(this.win,a,this.iE,n))}kE(t,s){return new Promise((e=>{const n=nt(this.win,"message",(i=>{const r=gt(i.data);if(r&&i.origin===s&&i.source===t&&"__AMPHTML__"==r.app&&"handshake-poll"==r.name){if(this.iE&&(!i.ports||!i.ports.length))throw new Error("Did not receive communication port from the Viewer!");const t=i.ports&&i.ports.length>0?i.ports[0]:new vt(this.win,s,this.win.parent);e(t),n()}}))}))}SE(t,s,e,n){const i=s.getUrl(),r=function(t){if(!function(t){return It.cdnProxyRegex.test(Vt(t).origin)}(t=Vt(t)))return t.href;const s=t.pathname.split("/"),e=s[1];g(Rt.has(e),"Unknown path prefix in url %s",t.href);const n=s[2],i="s"==n?"https://"+decodeURIComponent(s[3]):"http://"+decodeURIComponent(n);return g(i.indexOf(".")>0,"Expected a . in origin %s",i),s.splice(1,"s"==n?3:2),i+s.join("/")+function(t,s){if(!t||"?"==t)return"";const e=new RegExp("[?&](amp_(js[^&=]*|gsa|r|kit)|usqp)\\b[^&]*","g"),n=t.replace(e,"").replace(/^[?&]/,"");return n?"?"+n:""}(t.search)+(t.hash||"")}(i);return n.sendRequest("channelOpen",{"url":i,"sourceUrl":r},!0).then((()=>{this.zr(n,t,e)}))}zr(t,s,e){t.setDefaultHandler(((t,e,n)=>s.receiveMessage(t,e,n))),s.setMessageDeliverer(t.sendRequest.bind(t),e),it(this.win,"unload",this.GE.bind(this,t)),(s.hasCapability("swipe")||s.hasCapability("touch"))&&this.ZE(t),s.hasCapability("keyboard")&&this.QE(t),s.hasCapability("focus-rect")&&this.tT(t),null!=this.oE&&this.oE.setupMessaging(t)}GE(t){return t.sendRequest("unloaded",{},!0)}tT(t){new class{constructor(t,s){this.win=t,this.S=s,this.sT()}sT(){nt(this.win.document,"focusin",this.eT.bind(this),{capture:!1})}eT(t){t.defaultPrevented||this.S.sendRequest(t.type,{"focusTargetRect":t.target.getBoundingClientRect()},!1)}}(this.win,t)}ZE(t){new class{constructor(t,s){this.win=t,this.S=s,this.nT=!1,this.iT=[],s.registerHandler("scrollLock",this.rT.bind(this)),this.oT()}oT(){const t=this.xy.bind(this),s=this.win.document,e={capture:!1,passive:!this.nT};this.iT.push(nt(s,"touchstart",t,e),nt(s,"touchend",t,e),nt(s,"touchmove",t,e))}Vy(){this.iT.forEach((t=>t())),this.iT.length=0}xy(t){switch(t.type){case"touchstart":case"touchend":case"touchmove":this.hT(t);break;default:return}}hT(t){if(null!=t&&t.shouldViewerCancelPropagation)t.stopImmediatePropagation();else{if(t&&t.type){const s=this.cT(t);this.S.sendRequest(t.type,s,!1)}this.nT&&t.cancelable&&t.preventDefault()}}cT(t){const s=this.uT(t,Mt);return t.touches&&(s.touches=this.lT(t.touches)),t.changedTouches&&(s.changedTouches=this.lT(t.changedTouches)),s}lT(t){const s=[];for(let e=0;e<t.length;e++)s.push(this.uT(t[e],yt));return s}uT(t,s){const e={};for(let n=0;n<s.length;n++){const i=s[n];void 0!==t[i]&&(e[i]=t[i])}return e}rT(t,s,e){return this.nT=!!s,this.Vy(),this.oT(),e?Promise.resolve({}):void 0}}(this.win,t)}QE(t){new class{constructor(t,s){this.win=t,this.S=s,this.aT()}aT(){const t=this.xy.bind(this);nt(this.win,"keydown",t),nt(this.win,"keypress",t),nt(this.win,"keyup",t)}xy(t){(function(t){if(t.defaultPrevented)return!0;if("Escape"==t.key)return!1;switch(t.target.nodeName){case"INPUT":return"checkbox"!=t.target.type||" "==t.key;case"TEXTAREA":case"BUTTON":case"SELECT":case"OPTION":return!0}return t.target.hasAttribute&&t.target.hasAttribute("contenteditable")})(t)||this.eT(t)}eT(t){this.S.sendRequest(t.type,function(t){const s={};return Pt.forEach((e=>{void 0!==t[e]&&(s[e]=t[e])})),s}(t),!1)}}(this.win,t)}}(t.win).init()})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-viewer-integration-0.1.mjs.map